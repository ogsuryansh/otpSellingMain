<!doctype html>
<html lang="en">
<head>
  <%- include('partials/head') %>
  <title>Admin Dashboard - OTP Bot</title>
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    .stats-card {
      background: linear-gradient(135deg, #fff 0%, #f8fafc 100%);
      border: 1px solid rgba(226, 232, 240, 0.8);
    }
    .animate-pulse-slow {
      animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50 min-h-screen">
  <!-- Include Navbar -->
  <%- include('partials/navbar', { page: 'dashboard' }) %>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Page Header -->
    <div class="mb-8 flex items-center justify-between">
      <div>
        <h1 class="text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent mb-2">
          Admin Dashboard
        </h1>
        <p class="text-gray-600 text-lg">Welcome to your OTP Bot administration panel</p>
      </div>
      <button 
        onclick="clearDashboardStats()" 
        class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center gap-2 shadow-lg hover:shadow-xl"
        title="Clear dashboard stats and reset to default values"
      >
        <i class="fas fa-trash-alt"></i>
        Clear Stats
      </button>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      <!-- Today's Payment Card -->
      <div class="stats-card rounded-2xl shadow-lg p-6 card-hover relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-400/20 to-blue-600/20 rounded-full -translate-y-16 translate-x-16"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">Today's Payment</p>
              <p class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent">₹<%= todaysEarnings %></p>
            </div>
            <div class="w-14 h-14 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
              <i class="fas fa-money-bill-wave text-white text-xl"></i>
            </div>
          </div>
          <div class="pt-4 border-t border-gray-100">
            <p class="text-sm text-gray-600">
              Total: <span class="font-semibold text-green-600">₹<%= totalEarnings %></span>
            </p>
          </div>
        </div>
      </div>

      <!-- Today's Users Card -->
      <div class="stats-card rounded-2xl shadow-lg p-6 card-hover relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-purple-400/20 to-purple-600/20 rounded-full -translate-y-16 translate-x-16"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">Today's Users</p>
              <p class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-purple-800 bg-clip-text text-transparent"><%= todaysUsers %></p>
            </div>
            <div class="w-14 h-14 bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
              <i class="fas fa-users text-white text-xl"></i>
            </div>
          </div>
          <div class="pt-4 border-t border-gray-100">
            <p class="text-sm text-gray-600">
              Total: <span class="font-semibold text-green-600"><%= totalUsers %></span> users
            </p>
          </div>
        </div>
      </div>

      <!-- Numbers Sold Card -->
      <div class="stats-card rounded-2xl shadow-lg p-6 card-hover relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-orange-400/20 to-orange-600/20 rounded-full -translate-y-16 translate-x-16"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">Numbers Sold</p>
              <p class="text-3xl font-bold bg-gradient-to-r from-orange-600 to-orange-800 bg-clip-text text-transparent"><%= todaysSold %></p>
            </div>
            <div class="w-14 h-14 bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg">
              <i class="fas fa-chart-bar text-white text-xl"></i>
            </div>
          </div>
          <div class="pt-4 border-t border-gray-100">
            <p class="text-sm text-gray-600">
              Total: <span class="font-semibold text-green-600"><%= totalSold %></span> sold
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Services Section -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8 mb-8">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h2 class="text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent">Top Services</h2>
          <p class="text-gray-600 mt-1">Most popular services among users</p>
        </div>
        <a href="/my-services" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 py-3 rounded-xl text-sm font-medium transition-all duration-300 shadow-lg hover:shadow-xl">
          View All
        </a>
      </div>

      <% if(topServices && topServices.length > 0) { %>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <% topServices.forEach(function(service) { %>
            <div class="bg-gradient-to-br from-gray-50 to-white border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all duration-300 hover:border-blue-300 group">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold text-gray-900 text-lg"><%= service.name || service.service_name %></h3>
                <span class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full"><%= service.server_name %></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent"><%= service.price %></span>
                <span class="text-sm text-gray-600 bg-blue-50 px-3 py-1 rounded-full">
                  <i class="fas fa-users mr-1"></i><%= service.users || 0 %> users
                </span>
              </div>
            </div>
          <% }); %>
        </div>
      <% } else { %>
        <div class="text-center py-12">
          <div class="w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="fas fa-inbox text-3xl text-gray-400"></i>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-2">No services available yet</h3>
          <p class="text-gray-600 mb-6">Get started by adding your first service</p>
          <a href="/add-service" class="inline-block bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 py-3 rounded-xl text-sm font-medium transition-all duration-300 shadow-lg hover:shadow-xl">
            <i class="fas fa-plus mr-2"></i>Add Your First Service
          </a>
        </div>
      <% } %>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <a href="/add-server" class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8 hover:shadow-xl transition-all duration-300 hover:border-blue-300 group card-hover">
        <div class="flex items-center">
          <div class="w-14 h-14 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl flex items-center justify-center mr-5 group-hover:from-blue-200 group-hover:to-blue-300 transition-all duration-300">
            <i class="fas fa-server text-blue-600 text-xl"></i>
          </div>
          <div>
            <h3 class="font-bold text-gray-900 text-lg mb-1">Add Server</h3>
            <p class="text-gray-600">Configure new servers</p>
          </div>
        </div>
      </a>

      <a href="/add-service" class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8 hover:shadow-xl transition-all duration-300 hover:border-green-300 group card-hover">
        <div class="flex items-center">
          <div class="w-14 h-14 bg-gradient-to-br from-green-100 to-green-200 rounded-xl flex items-center justify-center mr-5 group-hover:from-green-200 group-hover:to-green-300 transition-all duration-300">
            <i class="fas fa-plus-circle text-green-600 text-xl"></i>
          </div>
          <div>
            <h3 class="font-bold text-gray-900 text-lg mb-1">Add Service</h3>
            <p class="text-gray-600">Create new services</p>
          </div>
        </div>
      </a>

      <a href="/connect-api" class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8 hover:shadow-xl transition-all duration-300 hover:border-purple-300 group card-hover">
        <div class="flex items-center">
          <div class="w-14 h-14 bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl flex items-center justify-center mr-5 group-hover:from-purple-200 group-hover:to-purple-300 transition-all duration-300">
            <i class="fas fa-plug text-purple-600 text-xl"></i>
          </div>
          <div>
            <h3 class="font-bold text-gray-900 text-lg mb-1">Connect API</h3>
            <p class="text-gray-600">Integrate external APIs</p>
          </div>
        </div>
      </a>

      <a href="/bot-settings" class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8 hover:shadow-xl transition-all duration-300 hover:border-orange-300 group card-hover">
        <div class="flex items-center">
          <div class="w-14 h-14 bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl flex items-center justify-center mr-5 group-hover:from-orange-200 group-hover:to-orange-300 transition-all duration-300">
            <i class="fas fa-cog text-orange-600 text-xl"></i>
          </div>
          <div>
            <h3 class="font-bold text-gray-900 text-lg mb-1">Bot Settings</h3>
            <p class="text-gray-600">Configure bot options</p>
          </div>
        </div>
      </a>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-white border-t border-gray-200 mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="text-center">
        <div class="flex items-center justify-center mb-4">
          <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-robot text-white text-sm"></i>
          </div>
          <span class="text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">OTP Bot</span>
        </div>
        <p class="text-gray-600">&copy; 2024 OTP Bot. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    async function clearDashboardStats() {
      if (!confirm('Are you sure you want to clear the dashboard stats? This will reset all values to default.')) {
        return;
      }

      try {
        const button = event.target.closest('button');
        const originalText = button.innerHTML;
        
        // Show loading state
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Clearing...';
        button.disabled = true;

        const response = await fetch('/clear-dashboard-stats', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        const result = await response.json();

        if (result.status === 1) {
          // Show success message
          button.innerHTML = '<i class="fas fa-check"></i> Cleared!';
          button.className = 'bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2';
          
          // Reload page after 2 seconds to show updated stats
          setTimeout(() => {
            window.location.reload();
          }, 2000);
        } else {
          // Show error message
          button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
          button.className = 'bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2';
          
          // Reset button after 3 seconds
          setTimeout(() => {
            button.innerHTML = originalText;
            button.className = 'bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2';
            button.disabled = false;
          }, 3000);
        }
      } catch (error) {
        console.error('Error clearing dashboard stats:', error);
        
        // Show error state
        const button = event.target.closest('button');
        button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
        button.className = 'bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2';
        button.disabled = false;
        
        // Reset button after 3 seconds
        setTimeout(() => {
          button.innerHTML = '<i class="fas fa-trash-alt"></i> Clear Stats';
          button.className = 'bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2';
        }, 3000);
      }
    }
  </script>
</body>
</html>